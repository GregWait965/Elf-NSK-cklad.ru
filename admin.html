<!DOCTYPE html>
<html xml:lang="ru" class="bx-core bx-win bx-no-touch bx-no-retina bx-chrome" lang="ru">
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0,maximum-scale=1.0, user-scalable=no">
    <title>ELF_admin</title>
   
    
    <link rel="stylesheet" href="admin_table_info.css" type="text/css" >
    <link rel="stylesheet" href="admin_messages.css" type="text/css" >
    <link rel="stylesheet" href="admin_planner.css" type="text/css" >
    <link rel="stylesheet" href="admin_navi.css" type="text/css" >
    <link rel="stylesheet" href="bootstrap.min.css" type="text/css" >
    <link rel="stylesheet" href="theme.min.css" type="text/css" >
    <link rel="icon" href="logo.ico" type="image/x-icon"   >
    <link rel="stylesheet" href="bell.css" type="text/css" >
    <link rel="stylesheet" href="scroll.css" type="text/css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>
<body>

    <!-- создание шапки (header) страницы  -->

<header>

    <section class="landing-block js-animation landing-block-node-mainimg u-bg-overlay g-pt-30 g-pb-30 slideInDown animated" style="background-color: var(--primary);">
        <div class="landing-block-node-inner container g-max-width-container text-uppercase text-capitalize">
        <h2 class="landing-block-node-title js-animation fadeIn animated g-line-height-1_1 g-font-weight-700 h1 g-color-white">админ</h2>
        
    </div>
        
    </section>
    <!-- дбавление иконки колокольчика -->
    <div class="notification-bell">
        <svg viewBox="0 0 24 24" width="24" height="24" fill="white">
            <path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6v-5c0-3.07-1.63-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.64 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2zm-2 1H8v-6c0-2.48 1.51-4.5 4-4.5s4 2.02 4 4.5v6z"/>
        </svg>
    </div>
    
</header>


<main>
    <br>
    <button type="submit" class="nav-btn"><a href="entrance.html">Вход в Л.К.</a></button>
<!-- Блок  страницы СООБЩЕНИЯ -->
<div class="message-form">
        <h3>Добавить новое сообщение</h3>
        <form id="newMessageForm">
            <textarea id="messageContent" placeholder="Введите текст сообщения..." required></textarea>
                
            
            <button type="submit" class="nav-btn">Отправить</button>
        </form>
</div>
<!--Табличная форма с данными по сотрудникам -->
<div>
    <h3>Показатели сотрудников</h3>
    <div id="tables-container"></div>
    <button class="update-btn" onclick="loadEmployeeData()">Обновить информацию</button>
    
</div>
<!-- Блок для страныцы ПЛАНЕРКА -->
<div class="task-panel">
    
    <h3>Задачи на сегодня</h3>
    <!-- Форма создания задачи -->
    <form id="taskForm" onsubmit="return false;">
        <div class="form-row">
            <div class="form-group">
                <label for="taskDate">Дата:</label>
                <input type="date" id="taskDate" required>
            </div>

            <div class="form-group">
                <label for="taskName">Задача:</label>
                <input type="text" id="taskName" required>
            </div>

            <div class="form-group employee-dropdown">
                <button type="button" id="employeeSelector" class="g-btn-primary">Выбрать исполнителей</button>
                <div id="employeeList" class="employee-list">
                    <!-- Список сотрудников будет добавлен через JavaScript -->
                </div>
            </div>
        </div>

        <div class="button-group">
            <button type="button" class="nav-btn " onclick="addTask()">Добавить задачу</button>
            <button type="button" class="nav-btn " onclick="publishTasks()">Опубликовать</button>
        </div>
    </form>

</div> 
<!-- !Вывод задач> -->
<div>
    <div class="published-tasks">
    <h3>Актуальные задачи</h3>
    <div id="publishedTaskBlocks"></div>
<!-- Контейнер для отображения задач -->
    <div id="taskBlocks"></div>
</div>
</main> 
<br>
<br>
<br>
<br>
<hr>
<!-- Добавляем навигационные кнопки -->
<div class="nav-buttons container">
    
    <a href="index.html" class="nav-btn">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V9z" stroke="white" stroke-width="2"/>
        </svg>
        <span>ПЛАНЕРКА</span>
    </a>
    
    <a href="messages.html" class="nav-btn">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v10z" stroke="white" stroke-width="2"/>
        </svg>
        <span>СООБЩЕНИЯ</span>
    </a>
    
    <a href="info.html" class="nav-btn">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="12" r="10" stroke="white" stroke-width="2"/>
            <path d="M12 8v8M12 7v.01" stroke="white" stroke-width="2"/>
        </svg>
        <span>ПОКАЗАТЕЛИ РАБОТЫ</span>
    </a>
    
    <a href="knowledge_base.html" class="nav-btn">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" stroke="white" stroke-width="2"/>
        </svg>
        <span>БАЗА ЗНАНИЙ</span>
    </a>
</div>


<script src="table.js"></script>
<script src="admin_messages.js"></script>
<script src="admin_planner.js"></script>
<script src="admin_bell.js"></script>
<script src="scroll.js"></script>
<script>
    // Remove the existing employee array and dummy data generation
// Replace with direct CSV import handling
function saveAndMaintainEmployeeData(newData) {
    // Get timestamp of update
    const updateTimestamp = new Date().getTime();
    
    // Create data storage object
    const dataStorage = {
        timestamp: updateTimestamp,
        employeeData: newData,
        lastUpdate: new Date().toLocaleString()
    };
    
    // Save to localStorage
    localStorage.setItem('employeeDataStorage', JSON.stringify(dataStorage));
}

function handleCSVImport() {
    const fileInput = document.createElement('input');
    fileInput.type = 'file';
    fileInput.accept = '.csv';
    
    fileInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        const reader = new FileReader();
        
        reader.onload = function(event) {
            const csvData = event.target.result;
            const decoder = new TextDecoder('windows-1251');
            const decodedData = decoder.decode(new Uint8Array(event.target.result));
            
            const rows = decodedData.split(/\r?\n/);
            const employeeData = parseEmployeeData(rows);
            
            // Save data with timestamp
            saveAndMaintainEmployeeData(employeeData);
            renderEmployeeTable(rows);
        };
        
        reader.readAsArrayBuffer(file);
    });
    
    fileInput.click();
}


// Add this function to load saved table data
function loadSavedTableData() {
    const savedStorage = localStorage.getItem('employeeDataStorage');
    if (savedStorage) {
        const { employeeData } = JSON.parse(savedStorage);
        if (employeeData && employeeData.length > 0) {
            const container = document.getElementById('tables-container');
            container.innerHTML = '';
            const table = document.createElement('table');
            
            let tableHTML = `
                <thead>
                    <tr>
                        <th>№</th>
                        <th>Фамилия, имя, отчество</th>
                        <th>Отраб. часов</th>
                        <th>Отраб. смен</th>
                        <th>Собрано строк</th>
                        <th>% участия в сборке</th>
                        <th>Табельный номер</th>
                        <th>% участия в погрузке</th>
                        <th>% Сред/смен. загруж.</th>
                        <th>Допущено ошибок</th>
                        <th>% допущ. ошибок</th>
                    </tr>
                </thead>
                <tbody>
            `;

            employeeData.forEach((employee, index) => {
                tableHTML += `
                    <tr>
                        <td>${employee.namb}</td>
                        <td>${employee.fullName}</td>
                        <td>${employee.hoursWorked}</td>
                        <td>${employee.shiftsWorked}</td>
                        <td>${employee.rowsCollected || '-'}</td>
                        <td>${employee.assemblyParticipation}</td>
                        <td>${employee.personnelNumber}</td>
                        <td>${employee.loadingParticipation}</td>
                        <td>${employee.averageShiftLoad}</td>
                        <td>${employee.errorsMade}</td>
                        <td>${employee.errorRate}</td>
                    </tr>
                `;
            });

            tableHTML += '</tbody>';
            table.innerHTML = tableHTML;
            container.appendChild(table);
        }
    }
}

// Add event listener to load table data when page loads
document.addEventListener('DOMContentLoaded', loadSavedTableData);

// Load saved imported data on page load
document.addEventListener('DOMContentLoaded', () => {
    const savedData = localStorage.getItem('importedEmployeeData');
    if (savedData) {
        const rows = JSON.parse(savedData);
        renderEmployeeTable(rows);
    }
});



function parseEmployeeData(rows) {
    const data = [];
    // Skip header row
    for(let i = 1; i < rows.length; i++) {
        if(!rows[i].trim()) continue;
        
        const columns = rows[i].split(';');
        data.push({
            namb: columns[0].trim(),
            fullName: columns[1].trim(),
            personnelNumber: columns[6].trim(),
            hoursWorked: columns[2].trim(),
            shiftsWorked: columns[3].trim(),
            assemblyParticipation: columns[5].trim(),
            loadingParticipation: columns[7].trim(),
            averageShiftLoad: columns[8].trim(),
            errorsMade: columns[9].trim(),
            errorRate: columns[10].trim(),
            rowsCollected: columns[4].trim()  // Added the 11th column
        });
    }
    return data;
}


// Update button event listener
document.querySelector('.update-btn').addEventListener('click', handleCSVImport);
</script>

<!-- блок стрелки скроллинга -->
<div class="scroll-to-top">
<i class="fas fa-arrow-up"></i>
</div>

</body>
</html>

